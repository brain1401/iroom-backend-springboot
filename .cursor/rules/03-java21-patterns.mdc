---
description: Java 21 í˜„ëŒ€ì  ê¸°ëŠ¥ í™œìš© ê·œì¹™ (Record, Pattern Matching, Text Blocks)
globs: **/dto/*.java, **/*Request.java, **/*Response.java, **/*Dto.java
alwaysApply: false
---

# Java 21 í˜„ëŒ€ì  íŒ¨í„´ í™œìš©

## ğŸ¯ Java 21 í•µì‹¬ ê¸°ëŠ¥ í™œìš©

### Record í™œìš© (í•„ìˆ˜)
- **ëª¨ë“  DTOëŠ” Recordë¡œ êµ¬í˜„**
- **ë¶ˆë³€ì„±ê³¼ ê°„ê²°ì„±** í™•ë³´  
- **Compact Constructor** í™œìš©

### Pattern Matching
- **Switch Expression** ì ê·¹ í™œìš©
- **instanceof íŒ¨í„´** í™œìš©

### Text Blocks  
- **ê¸´ ë¬¸ìì—´** ê°€ë…ì„± í–¥ìƒ
- **SQL ì¿¼ë¦¬, JSON í…œí”Œë¦¿** ë“±

## ğŸ“‹ Record ì‚¬ìš© ê·œì¹™

### âœ… ê¸°ë³¸ Record íŒ¨í„´
```java
/**
 * ì‚¬ìš©ì ë¡œê·¸ì¸ ìš”ì²­ DTO
 */
@Schema(description = "í•™ìƒ ë¡œê·¸ì¸ ìš”ì²­")
public record UserLoginRequest(
    @NotBlank(message = "í•™ìƒ ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.")
    @Schema(description = "í•™ìƒ ì´ë¦„", example = "ê¹€ì² ìˆ˜")
    String name,
    
    @NotBlank(message = "í•™ìƒ ì „í™”ë²ˆí˜¸ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.")
    @Pattern(regexp = "^01[0-9]-[0-9]{3,4}-[0-9]{4}$", 
             message = "ì˜¬ë°”ë¥¸ ì „í™”ë²ˆí˜¸ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.")
    @Schema(description = "í•™ìƒ ì „í™”ë²ˆí˜¸", example = "010-1234-5678")
    String phone
) {
    /**
     * Compact Constructor - ì…ë ¥ ê²€ì¦ ìˆ˜í–‰
     */
    public UserLoginRequest {
        Objects.requireNonNull(name, "nameì€ í•„ìˆ˜ì…ë‹ˆë‹¤");
        Objects.requireNonNull(phone, "phoneì€ í•„ìˆ˜ì…ë‹ˆë‹¤");
    }
}
```

### âœ… ì •ì  íŒ©í† ë¦¬ ë©”ì„œë“œ ì œê³µ
```java
/**
 * ì‹œìŠ¤í…œ í—¬ìŠ¤ì²´í¬ ì‘ë‹µ DTO
 */
public record SystemHealthDto(
    @Schema(description = "ìƒíƒœ") String status,
    @Schema(description = "íƒ€ì„ìŠ¤íƒ¬í”„") LocalDateTime timestamp,
    @Schema(description = "ë©”ì‹œì§€") String message,
    @Schema(description = "ì„œë¹„ìŠ¤ë³„ ìƒíƒœ") Map<String, ServiceHealthDto> services
) {
    /**
     * ì •ìƒ ìƒíƒœ í—¬ìŠ¤ì²´í¬ ì‘ë‹µ ìƒì„±
     */
    public static SystemHealthDto up(String message, Map<String, ServiceHealthDto> services) {
        return new SystemHealthDto("UP", LocalDateTime.now(), message, services);
    }
    
    /**
     * ì˜¤ë¥˜ ìƒíƒœ í—¬ìŠ¤ì²´í¬ ì‘ë‹µ ìƒì„±
     */
    public static SystemHealthDto down(String message, Map<String, ServiceHealthDto> services) {
        return new SystemHealthDto("DOWN", LocalDateTime.now(), message, services);
    }
    
    /**
     * ì¤‘ì²© Record - ì„œë¹„ìŠ¤ë³„ í—¬ìŠ¤ì²´í¬ ì •ë³´
     */
    public record ServiceHealthDto(
        @Schema(description = "ì„œë¹„ìŠ¤ ìƒíƒœ") String status,
        @Schema(description = "ìƒíƒœ ë©”ì‹œì§€") String message,
        @Schema(description = "ì‘ë‹µ ì‹œê°„") Long responseTimeMs
    ) {
        public static ServiceHealthDto up(String message, Long responseTime) {
            return new ServiceHealthDto("UP", message, responseTime);
        }
        
        public static ServiceHealthDto down(String message) {
            return new ServiceHealthDto("DOWN", message, null);
        }
    }
}
```

### âœ… Entityì—ì„œ DTO ë³€í™˜ íŒ¨í„´
```java
/**
 * ì‚¬ìš©ì ì‘ë‹µ DTO
 */
public record UserDto(
    @Schema(description = "ì‚¬ìš©ì ID", example = "1") 
    Long id,
    
    @Schema(description = "ì‚¬ìš©ìëª…", example = "ê¹€ì² ìˆ˜") 
    String name,
    
    @Schema(description = "ì „í™”ë²ˆí˜¸", example = "010-1234-5678")
    String phone,
    
    @Schema(description = "ë“±ë¡ì¼ì‹œ")
    LocalDateTime createdAt
) {
    /**
     * Entityì—ì„œ DTOë¡œ ë³€í™˜í•˜ëŠ” ì •ì  íŒ©í† ë¦¬ ë©”ì„œë“œ
     */
    public static UserDto from(User user) {
        return new UserDto(
            user.getId(),
            user.getName(),
            user.getPhone(),
            user.getCreatedAt()
        );
    }
    
    /**
     * List<Entity>ë¥¼ List<DTO>ë¡œ ë³€í™˜
     */
    public static List<UserDto> from(List<User> users) {
        return users.stream()
            .map(UserDto::from)
            .toList();
    }
}
```

### âœ… ë³µí•© ë°ì´í„° êµ¬ì¡° Record
```java
/**
 * ì‹œí—˜ ë‹µì•ˆ ì²˜ë¦¬ ì‘ë‹µ DTO
 */
public record ExamAnswerSheetProcessResponse(
    @Schema(description = "ì²˜ë¦¬ëœ ì´ë¯¸ì§€ ìˆ˜") 
    Integer processedImageCount,
    
    @Schema(description = "ìƒì„±ëœ ë‹µì•ˆ ìˆ˜")
    Integer createdAnswerCount,
    
    @Schema(description = "ë‹µì•ˆ ëª©ë¡")
    List<ExamAnswerResponse> answers,
    
    @Schema(description = "ì²˜ë¦¬ ìƒíƒœ")
    ProcessStatus status,
    
    @Schema(description = "ê²°ê³¼ ë©”ì‹œì§€")
    String message
) {
    /**
     * ì²˜ë¦¬ ìƒíƒœ ì—´ê±°í˜•
     */
    public enum ProcessStatus {
        COMPLETED, PARTIAL, FAILED
    }
    
    /**
     * ì„±ê³µì ì¸ ì²˜ë¦¬ ê²°ê³¼ ìƒì„±
     */
    public static ExamAnswerSheetProcessResponse success(
            int imageCount, 
            List<ExamAnswerResponse> answers) {
        return new ExamAnswerSheetProcessResponse(
            imageCount,
            answers.size(),
            answers,
            ProcessStatus.COMPLETED,
            "ë‹µì•ˆì§€ ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."
        );
    }
}
```

## ğŸ”„ Pattern Matching í™œìš©

### âœ… Switch Expression ì‚¬ìš©
```java
/**
 * ê²°ê³¼ ìƒíƒœì— ë”°ë¥¸ ë©”ì‹œì§€ ìƒì„±
 */
public String getStatusMessage(ResultStatus status) {
    return switch (status) {
        case SUCCESS -> "ì²˜ë¦¬ ì„±ê³µ";
        case ERROR -> "ì²˜ë¦¬ ì‹¤íŒ¨";
        case PENDING -> "ì²˜ë¦¬ ëŒ€ê¸° ì¤‘";
        case IN_PROGRESS -> "ì²˜ë¦¬ ì§„í–‰ ì¤‘";
    };
}

/**
 * ì‹œí—˜ ë‚œì´ë„ì— ë”°ë¥¸ ì ìˆ˜ ê³„ì‚°
 */
public int calculateScore(Question.Difficulty difficulty, boolean isCorrect) {
    if (!isCorrect) return 0;
    
    return switch (difficulty) {
        case í•˜ -> 3;
        case ì¤‘ -> 5; 
        case ìƒ -> 7;
    };
}
```

### âœ… instanceof íŒ¨í„´ ë§¤ì¹­
```java
/**
 * ì˜ˆì™¸ íƒ€ì…ì— ë”°ë¥¸ ì²˜ë¦¬
 */
public ApiResponse<Void> handleException(Exception e) {
    return switch (e) {
        case UserNotFoundException unf -> 
            ApiResponse.error("ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: " + unf.getMessage());
        case ValidationException ve -> 
            ApiResponse.error("ì…ë ¥ ë°ì´í„°ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤: " + ve.getMessage());
        case BusinessException be -> 
            ApiResponse.error("ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ìœ„ë°˜: " + be.getMessage());
        case Exception ge -> 
            ApiResponse.error("ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤");
    };
}
```

## ğŸ“ Text Blocks í™œìš©

### âœ… ë³µì¡í•œ ì¿¼ë¦¬ë¬¸
```java
/**
 * ë³µí•© ì¡°ê±´ ì¿¼ë¦¬
 */
private static final String COMPLEX_SEARCH_QUERY = """
    SELECT u.id, u.name, u.phone, 
           COUNT(es.id) as submission_count,
           AVG(es.score) as average_score
    FROM users u
    LEFT JOIN exam_submissions es ON u.id = es.user_id
    WHERE u.active = true
    AND u.created_at >= :startDate
    AND u.created_at <= :endDate
    GROUP BY u.id, u.name, u.phone
    HAVING COUNT(es.id) > 0
    ORDER BY average_score DESC
    """;
```

### âœ… JSON í…œí”Œë¦¿
```java
/**
 * AI ì„œë²„ ìš”ì²­ JSON ìƒì„±
 */
public String createAiRecognitionRequest(String imageUrl, String examType) {
    return """
        {
            "image_url": "%s",
            "exam_type": "%s",
            "recognition_options": {
                "language": "ko",
                "format": "handwritten",
                "confidence_threshold": 0.8
            },
            "response_format": {
                "include_confidence": true,
                "include_coordinates": false
            }
        }
        """.formatted(imageUrl, examType);
}
```

### âœ… HTML í…œí”Œë¦¿
```java
/**
 * ë¬¸ì œ HTML ë³€í™˜
 */
public String generateQuestionHtml(Question question) {
    return """
        <div class="question-container">
            <div class="question-header">
                <h3>ë¬¸ì œ %dë²ˆ</h3>
                <span class="difficulty %s">ë‚œì´ë„: %s</span>
            </div>
            <div class="question-content">
                %s
            </div>
            <div class="answer-section">
                <label>ì •ë‹µ: </label>
                <span class="answer-key">%s</span>
            </div>
        </div>
        """.formatted(
            question.getId(),
            question.getDifficulty().name().toLowerCase(),
            question.getDifficulty(),
            question.getQuestionTextAsHtml(),
            question.getAnswerKey()
        );
}
```

## âŒ í”¼í•´ì•¼ í•  íŒ¨í„´

### âŒ DTOì— ì¼ë°˜ í´ë˜ìŠ¤ ì‚¬ìš©
```java
// ì˜ëª»ëœ ë°©ì‹ - ì‚¬ìš© ê¸ˆì§€
public class UserDto {
    private Long id;
    private String name;
    private String email;
    
    // getter, setter, equals, hashCode, toString...
    // Recordë¥¼ ì‚¬ìš©í•˜ë©´ ìë™ ìƒì„±ë¨
}
```

### âŒ ê¸°ì¡´ switch ë¬¸ ì‚¬ìš©
```java
// êµ¬ì‹ ë°©ì‹ - ì§€ì–‘
public String getStatusMessage(ResultStatus status) {
    switch (status) {
        case SUCCESS:
            return "ì²˜ë¦¬ ì„±ê³µ";
        case ERROR:
            return "ì²˜ë¦¬ ì‹¤íŒ¨";
        default:
            return "ì•Œ ìˆ˜ ì—†ìŒ";
    }
}
```

### âŒ ê¸´ ë¬¸ìì—´ ì—°ê²°
```java
// ê°€ë…ì„±ì´ ë–¨ì–´ì§€ëŠ” ë°©ì‹ - ì§€ì–‘
String query = "SELECT u.id, u.name, u.phone " +
               "FROM users u " +
               "WHERE u.active = true " +
               "AND u.created_at >= ? " +
               "ORDER BY u.name";
```

## ğŸ¯ Java 21 í™œìš© ì²´í¬ë¦¬ìŠ¤íŠ¸

ìƒˆ í´ë˜ìŠ¤ ì‘ì„± ì‹œ:
- [ ] DTOëŠ” Recordë¡œ êµ¬í˜„í–ˆëŠ”ê°€?
- [ ] Compact Constructorì—ì„œ ê²€ì¦ì„ ìˆ˜í–‰í•˜ëŠ”ê°€?
- [ ] ì •ì  íŒ©í† ë¦¬ ë©”ì„œë“œë¥¼ ì œê³µí•˜ëŠ”ê°€?
- [ ] Switch Expressionì„ í™œìš©í–ˆëŠ”ê°€?
- [ ] Text Blocksë¥¼ ì ì ˆíˆ ì‚¬ìš©í–ˆëŠ”ê°€?
- [ ] íŒ¨í„´ ë§¤ì¹­ì„ í™œìš©í–ˆëŠ”ê°€?

Java 21ì˜ í˜„ëŒ€ì  ê¸°ëŠ¥ì„ ì ê·¹ í™œìš©í•˜ì—¬ ê°„ê²°í•˜ê³  ì½ê¸° ì‰¬ìš´ ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”.